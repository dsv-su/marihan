From feae7393085f11f7b2b0e0ac566bc78fc8fce0bf Mon Sep 17 00:00:00 2001
From: Pavel Sokolov <pavel.m.sokolov@gmail.com>
Date: Thu, 12 Jan 2017 12:54:47 +0300
Subject: [PATCH] Fix login functions to introduce needed variables for new
 login page

---
 auth/classes/output/login.php | 3 ++-
 login/index.php               | 1 +
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/auth/classes/output/login.php b/auth/classes/output/login.php
index 5b924bb..3216e8f 100644
--- a/auth/classes/output/login.php
+++ b/auth/classes/output/login.php
@@ -146,10 +146,11 @@ class login implements renderable, templatable {
         $data->hasinstructions = !empty($this->instructions);
         $data->identityproviders = $identityproviders;
         list($data->instructions, $data->instructionsformat) = external_format_text($this->instructions, FORMAT_MOODLE,
-            context_system::instance()->id);
+            context_system::instance()->id, null, null, null, array('noclean' => true));
         $data->loginurl = $this->loginurl->out(false);
         $data->rememberusername = $this->rememberusername;
         $data->passwordautocomplete = $this->passwordautocomplete;
+        $data->shibbolethauth = new moodle_url($CFG->httpswwwroot . '/auth/shibboleth');
         $data->signupurl = $this->signupurl->out(false);
         $data->username = $this->username;
 
diff --git a/login/index.php b/login/index.php
index e461234..d27e74e 100644
--- a/login/index.php
+++ b/login/index.php
@@ -45,6 +45,7 @@ if ($cancel) {
 
 //HTTPS is required in this page when $CFG->loginhttps enabled
 $PAGE->https_required();
+$PAGE->requires->jquery();
 
 $context = context_system::instance();
 $PAGE->set_url("$CFG->httpswwwroot/login/index.php");
-- 
2.10.1 (Apple Git-78)

